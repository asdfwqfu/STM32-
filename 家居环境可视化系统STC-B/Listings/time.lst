C51 COMPILER V9.54   TIME                                                                  12/20/2023 22:18:27 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE TIME
OBJECT MODULE PLACED IN .\Objects\time.obj
COMPILER INVOKED BY: F:\Keil_v5\C51\BIN\C51.EXE time.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc) DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\time.lst) TABS(2) OBJECT(.\Objects\time.obj)

line level    source

   1          #include "STC15F2K60S2.H" 
   2          #include "intrins.H" 
   3          #include "time.H" 
   4          #define uchar unsigned char
   5          #define uint unsigned int
   6          
   7          
   8          #define DS1302_SECOND_WRITE 0x80      
   9          #define DS1302_MINUTE_WRITE 0x82
  10          #define DS1302_HOUR_WRITE   0x84 
  11          #define DS1302_WEEK_WRITE   0x8A
  12          #define DS1302_DAY_WRITE    0x86
  13          #define DS1302_MONTH_WRITE  0x88
  14          #define DS1302_YEAR_WRITE   0x8C
  15          
  16          #define DS1302_SECOND_READ  0x81
  17          #define DS1302_MINUTE_READ  0x83
  18          #define DS1302_HOUR_READ    0x85 
  19          #define DS1302_WEEK_READ    0x8B
  20          #define DS1302_DAY_READ     0x87
  21          #define DS1302_MONTH_READ   0x89
  22          #define DS1302_YEAR_READ    0x8D
  23          
  24          
  25          
  26          sbit Rtc_sclk = P1^5;   
  27          sbit Rtc_rst  = P1^6;   
  28          sbit Rtc_io   = P5^4;   
  29          
  30          uchar temp;       
  31          
  32          RTC_TimeTypeDef sTime;      
  33          
  34          void Ds1302_write(uchar temp)   
  35          {
  36   1        uchar i;
  37   1        for(i=0;i<8;i++)      
  38   1        {
  39   2          Rtc_sclk=0;     
  40   2          Rtc_io=(bit)(temp&0x01);
  41   2          temp>>=1;       
  42   2          Rtc_sclk=1;       
  43   2        }
  44   1      }
  45          
  46          
  47          uchar Ds1302_read()  
  48          {
  49   1         uchar i, dat;
  50   1         for(i=0;i<8;i++)     
  51   1         {
  52   2          Rtc_sclk=0;     
  53   2          dat>>=1;         
  54   2          if(Rtc_io==1)   
C51 COMPILER V9.54   TIME                                                                  12/20/2023 22:18:27 PAGE 2   

  55   2          dat|=0x80;      
  56   2          Rtc_sclk=1;     
  57   2         }
  58   1         return dat;        
  59   1      }
  60          
  61          void WriteDS1302(uchar Addr, uchar Data)    
  62          {
  63   1          Rtc_rst = 0;          
  64   1          Rtc_sclk = 0;       
  65   1          Rtc_rst = 1;            
  66   1          Ds1302_write(Addr);       
  67   1          Ds1302_write(Data);       
  68   1          Rtc_rst = 0;          
  69   1          Rtc_sclk = 1;            
  70   1      }
  71          
  72          
  73          uchar ReadDS1302(uchar cmd)
  74          {
  75   1          uchar Data;
  76   1          Rtc_rst = 0;    
  77   1          Rtc_sclk = 0;   
  78   1          Rtc_rst = 1;    
  79   1          Ds1302_write(cmd);    
  80   1          Data =Ds1302_read();   
  81   1          Rtc_rst = 0;      
  82   1          Rtc_sclk = 1;     
  83   1          return Data;    
  84   1      }
  85          
  86          
  87          
  88          RTC_TimeTypeDef DS1302_GetTime()
  89          {
  90   1        RTC_TimeTypeDef Time; 
  91   1        uchar ReadValue;
  92   1        ReadValue = ReadDS1302(DS1302_SECOND_READ);
  93   1        Time.Seconds=((ReadValue&0x70)>>4)*10 + (ReadValue&0x0F);    
  94   1        ReadValue=ReadDS1302(DS1302_MINUTE_READ);
  95   1        Time.Minutes = ((ReadValue&0x70)>>4)*10 + (ReadValue&0x0F);     
  96   1        ReadValue = ReadDS1302(DS1302_HOUR_READ);
  97   1        Time.Hours = (((ReadValue&0x70)>>4)*10 + (ReadValue&0x0F))%24;      
  98   1        
  99   1        return Time;
 100   1      }
 101          
 102          
 103          void Initial_DS1302(void) 
 104          {
 105   1        WriteDS1302(0x8E,0x00);     
 106   1        temp=ReadDS1302(DS1302_SECOND_READ)&0x7f ;
 107   1        WriteDS1302(0x80,temp);      
 108   1        WriteDS1302(0x8E,0x80);                
 109   1      } 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    191    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.54   TIME                                                                  12/20/2023 22:18:27 PAGE 3   

   DATA SIZE        =      4       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
